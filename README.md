# 3D G-code Map Feature Post Processing (MFPP)

Add colored [isolines (contour lines/elevation lines)](https://en.wikipedia.org/wiki/Contour_line) and recolor [elevation ranges](https://desktop.arcgis.com/en/arcmap/latest/map/styles-and-symbols/working-with-color-ramps.htm) to [3D printable map models](https://ansonliu.com/maps/). **3D G-code Map Feature Post Processing (MFPP)** is made for 3D topo map models but any 3D model can be recolored with 2 additional colors. 

[Download the latest version of MFPP](https://github.com/ansonl/topo-map-post-processing/releases)!

MFPP adds additional features to the model by post processing sliced [3D printer G-code](https://marlinfw.org/meta/gcode/). 3D models and printing g-code can be recolored at either layer or individual feature/line level granularity.

- **Feature/Line Type Scoping** - Recoloring can be set to only affect specific printing feature/line types. *Only want to recolor top surfaces or walls at certain heights? No problem!*

- **G-code Feature Print Order Optimization** - Printed features are rearranged for faster, more consistent prints. Nozzle pressure is maintained and the number of toolchanges is decreased.

- **Wipe/Coasting Compensation** - Existing Wipe/Coasting flow compensation generated by the slicer is retained even when g-code features are relocated.

- **Prime Tower Compatible** - Existing Prime Towers are reused for optimal filament flow and color flushing. *No prime tower or large prime tower? I don't judge. Both configurations are supported.*

- **Slicer Compatibility** - Tested to be compatible with PrusaSlicer and Bambu Studio.

![map feature gcode post processing screenshot](/assets/gui_screenshot.png)

If you find this tool helpful, please leave feedback and consider supporting my development and 3D modeling with a [Printables](https://www.printables.com/@ansonl) "club membership" or [Paypal](https://paypal.me/0x80).

## Current G-code flavors supported

- Marlin 2 ([PrusaSlicer](https://github.com/prusa3d/PrusaSlicer)/[Bambu Studio](https://github.com/bambulab/BambuStudio))

Your slicer **must generate g-code with [Relative Extrusion](https://www.ideamaker.io/dictionaryDetail.html?name=Relative%20Extrusion&category_name=Printer%20Settings)**. PrusaSlicer and Bambu Studio default to relative extrusion. Cura defaults to absolute extrusion and relative extrusion must be enabled.

| Slicer | Tested Version |
| --- | --- |
| PrusaSlicer | 2.7.1 |
| Bambu Studio | 1.8.2.56 |
| Cura | Looking for testers |

If you would like support for your printer or slicer G-code flavor to be added, please open an issue and if you are able to test the G-code on your printer.

## Getting Started

Set up your slicer and printer for MFPP by following the steps on every page below:

- [Slicer Setup](slicer-setup.md)

- [Configuration](configuration-setup.md)

- [Minimal Toolchange G-code](minimal-toolchange-gcode.md)

After following all the above set up pages, download the [latest release of MFPP](https://github.com/ansonl/topo-map-post-processing/releases) and run `gui.exe`.

If a release of MFPP has not been built for your OS, you can [download](https://github.com/ansonl/topo-map-post-processing/archive/refs/heads/master.zip) this repo, navigate to it in the command line and run `python gui.py`.

## Limitations

| üöß Issue | Solution |
| --- | --- |
| Color change may not happen on layers where a feature/line type spans a layer boundary. | The console log will show 0 or low amount of features found on that layer relative to other layers. Some slicers will continue features/lines between layers which makes detecting features/lines less reliable. Make a bug report. |
| Support and Bridge features are not explicitly prioritized to pprint first.  | I may prioritize them in the future. Add an issue on your use case for this. |
| Mixed OS line endings in the same file will lead to G-code errors. MFPP tries to auto detect the line ending used with first line ending found. | Select the correct line ending of your G-code instead of auto detect. Either convert the entire G-code file with Unix line endings to Windows line endings before post processing or generate the G-code on Windows. [Python on Windows does not handle Unix line endings correctly.](https://stackoverflow.com/questions/15934950/python-file-tell-giving-strange-numbers) |
| Only one isoline interval and/or colored elevation range can be set. | Only one of each is exposed at the moment. The implementation could support more in the future if there is a use case. |

## Bug Reports

Open an issue on Github. Please note the OS, Slicer, printer, and provide the 3D model, MFPP configuration JSON, before/after G-code, and console log.

## License and Disclaimer

GNU AFFERO GENERAL PUBLIC LICENSE v3.0

Copyright ¬© 2023 Anson Liu

THE SOFTWARE IS PROVIDED ‚ÄúAS IS‚Äù, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
